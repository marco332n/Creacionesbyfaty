<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disponibles - Accesorios by Faty</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilos de botones y alineación */
        .cart-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .btn-cart { flex: 1; }
        .btn-wishlist {
            background-color: white; border: 2px solid #ff6b6b; color: #ff6b6b;
            padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .btn-wishlist:hover { background-color: #ff6b6b; color: white; }

        /* Estilos del Juego Offline */
        #offline-game-container {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f3eaff; z-index: 10000; text-align: center; padding-top: 50px;
        }
        #game-canvas {
            width: 300px; height: 150px; border-bottom: 3px solid #435D78;
            margin: 50px auto; position: relative; overflow: hidden; background: white; border-radius: 10px;
        }
        #player-monito {
            width: 40px; height: 40px; position: absolute; bottom: 0; left: 20px;
            transition: bottom 0.2s ease-out;
        }
        #cactus {
            width: 20px; height: 30px; background: #435D78;
            position: absolute; bottom: 0; right: -50px; border-radius: 5px 5px 0 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-wrapper">
                <img src="logotipo.png.png" alt="Logo">
                <div class="title-container">
                    <h1>Accesorios</h1>
                    <h2>by faty</h2>
                </div>
            </div>
            <div class="right-group">
                <div class="icons-container">
                    <a href="index.html" class="icon-link"><i class="fa-solid fa-house"></i></a>
                    <a href="login.html" class="icon-link" id="user-link"><i class="fa-regular fa-user"></i></a>
                    <a href="https://goo.gl/maps/uytQGQUzdPxbK42b9" class="icon-link" target="_blank"><i class="fa-solid fa-location-dot"></i></a>
                    <a href="carrito.html" style="text-decoration: none;">
                        <div class="cart-wrapper">
                            <i class="fa-solid fa-cart-shopping"></i>
                            <span class="cart-badge" id="cart-count">0</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <h3 class="section-title">Productos Disponibles</h3>
        
        <section id="monos-ninos" class="products-section">
            <h3 class="products-title">Moños para Niños</h3>
            <div class="products-grid">
                
                <div class="product-card">
                    <div class="product-image"><img src="moño-1.png.png" alt="Moño 1"></div>
                    <div class="product-info">
                        <h5>Moño con aplique 1</h5>
                        <div class="product-buttons">
                            <div class="cart-row">
                                <button class="btn-cart" data-name="Moño con aplique 1" data-price="25000">Añadir al Carrito</button>
                                <button class="btn-wishlist" data-name="Moño con aplique 1" data-price="25000"><i class="fa-regular fa-heart"></i></button>
                            </div>
                            <a href="https://wa.me/595986898428?text=Hola!%20Moño%201" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image"><img src="moño-2.png.png" alt="Moño 2"></div>
                    <div class="product-info">
                        <h5>Moño con aplique 2</h5>
                        <div class="product-buttons">
                            <div class="cart-row">
                                <button class="btn-cart" data-name="Moño con aplique 2" data-price="25000">Añadir al Carrito</button>
                                <button class="btn-wishlist" data-name="Moño con aplique 2" data-price="25000"><i class="fa-regular fa-heart"></i></button>
                            </div>
                            <a href="https://wa.me/595986898428?text=Hola!%20Moño%202" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image"><img src="moño-3.png.png" alt="Moño 3"></div>
                    <div class="product-info">
                        <h5>Moño con aplique 3</h5>
                        <div class="product-buttons">
                            <div class="cart-row">
                                <button class="btn-cart" data-name="Moño con aplique 3" data-price="30000">Añadir al Carrito</button>
                                <button class="btn-wishlist" data-name="Moño con aplique 3" data-price="30000"><i class="fa-regular fa-heart"></i></button>
                            </div>
                            <a href="https://wa.me/595986898428?text=Hola!%20Moño%203" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image"><img src="moño-4.png.png" alt="Moño 4"></div>
                    <div class="product-info">
                        <h5>Moño con aplique 4</h5>
                        <div class="product-buttons">
                            <div class="cart-row">
                                <button class="btn-cart" data-name="Moño con aplique 4" data-price="28000">Añadir al Carrito</button>
                                <button class="btn-wishlist" data-name="Moño con aplique 4" data-price="28000"><i class="fa-regular fa-heart"></i></button>
                            </div>
                            <a href="https://wa.me/595986898428?text=Hola!%20Moño%204" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image"><img src="moño-5.png.png" alt="Moño 5"></div>
                    <div class="product-info">
                        <h5>Moño con aplique 5</h5>
                        <div class="product-buttons">
                            <div class="cart-row">
                                <button class="btn-cart" data-name="Moño con aplique 5" data-price="35000">Añadir al Carrito</button>
                                <button class="btn-wishlist" data-name="Moño con aplique 5" data-price="35000"><i class="fa-regular fa-heart"></i></button>
                            </div>
                            <a href="https://wa.me/595986898428?text=Hola!%20Moño%205" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <div id="offline-game-container">
        <h2 style="color:#435D78;">¡Ups! Sin conexión</h2>
        <p>¡Ayuda al moño a saltar mientras vuelve el internet!</p>
        <div id="game-canvas">
            <div id="player-monito"><img src="logotipo.png.png" style="width:100%;"></div>
            <div id="cactus"></div>
        </div>
        <p id="score-text" style="font-weight:bold;">Puntos: 0</p>
        <button onclick="location.reload()" style="padding:10px 20px; background:#435D78; color:white; border:none; border-radius:10px; cursor:pointer;">Reintentar conexión</button>
    </div>

    <script>
        let score = 0;
        let isJumping = false;
        let gameActive = false;

        function jump() {
            const player = document.getElementById('player-monito');
            if (isJumping || !player) return;
            isJumping = true;
            player.style.bottom = "80px";
            setTimeout(() => { if(player) player.style.bottom = "0"; isJumping = false; }, 400);
        }

        function startGame() {
            if (gameActive) return;
            gameActive = true;
            const cactus = document.getElementById('cactus');
            const scoreText = document.getElementById('score-text');
            let cactusPos = -50;
            
            let gameLoop = setInterval(() => {
                if (document.getElementById('offline-game-container').style.display === 'none') {
                    clearInterval(gameLoop);
                    gameActive = false;
                    return;
                }
                cactusPos += 6; 
                if (cactusPos > 330) { cactusPos = -50; score++; scoreText.innerText = "Puntos: " + score; }
                cactus.style.right = cactusPos + "px";

                let playerBottom = parseInt(window.getComputedStyle(document.getElementById('player-monito')).getPropertyValue("bottom"));
                if (cactusPos > 240 && cactusPos < 275 && playerBottom < 35) {
                    alert("¡Chocaste! Puntos: " + score);
                    score = 0; scoreText.innerText = "Puntos: 0"; cactusPos = -50;
                }
            }, 20);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const gameContainer = document.getElementById('offline-game-container');
            
            // Detectar Conexión
            window.addEventListener('offline', () => { gameContainer.style.display = 'block'; startGame(); });
            window.addEventListener('online', () => { gameContainer.style.display = 'none'; });

            // Controles Juego
            document.addEventListener('keydown', (e) => { if(e.code === "Space") jump(); });
            gameContainer.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });

            // --- Lógica Carrito y Usuario ---
            const nombre = localStorage.getItem('usuarioLogueado');
            if (localStorage.getItem('isLoggedIn') === 'true' && nombre) {
                document.getElementById('user-link').innerHTML = `<span style="color: white; font-weight: bold; font-size: 13px;">Hola, ${nombre}</span>`;
            }

            let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
            const badge = document.getElementById('cart-count');
            const updateBadge = () => { badge.innerText = carrito.reduce((s, i) => s + i.cantidad, 0); };

            // Añadir al carrito
            document.querySelectorAll('.btn-cart').forEach(b => {
                b.addEventListener('click', () => {
                    const n = b.getAttribute('data-name');
                    const p = parseInt(b.getAttribute('data-price'));
                    const ex = carrito.find(i => i.nombre === n);
                    if(ex) ex.cantidad++; else carrito.push({nombre:n, precio:p, cantidad:1});
                    localStorage.setItem('carrito', JSON.stringify(carrito));
                    updateBadge();
                    b.innerText = "¡Añadido! ✓"; setTimeout(() => b.innerText = "Añadir al Carrito", 1000);
                });
            });

            // Añadir a Favoritos
            document.querySelectorAll('.btn-wishlist').forEach(b => {
                b.addEventListener('click', () => {
                    const n = b.getAttribute('data-name');
                    const p = parseInt(b.getAttribute('data-price'));
                    if (!favoritos.find(i => i.nombre === n)) {
                        favoritos.push({ nombre: n, precio: p });
                        localStorage.setItem('favoritos', JSON.stringify(favoritos));
                        b.innerHTML = '<i class="fa-solid fa-heart"></i>';
                        b.style.backgroundColor = "#ff6b6b"; b.style.color = "white";
                    } else { alert("Ya está en favoritos"); }
                });
            });

            updateBadge();
        });
    </script>
</body>
</html>
